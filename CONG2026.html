<!doctype html><html lang="vi"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Ứng dụng luyện cộng & trừ lớp 1</title><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style>
body{font-family:"Comic Sans MS",Arial,sans-serif;background:#f2f9ff;text-align:center;margin:0;padding:0}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:15px;box-shadow:0 0 15px #999;position:relative}
h2{font-size:1.8em;margin-bottom:12px;font-weight:bold;color:#0077cc}
input,button{margin:5px;padding:10px;font-size:1.1em;border-radius:10px;border:2px solid #0077cc}
input{font-weight:bold;background:#e6f2ff;text-align:center}
#studentName{background:#00cc66!important;font-size:1.6em!important;font-weight:bold;width:25%!important;text-align:center!important;color:#fff}
.input-row{display:flex;align-items:center;justify-content:center;gap:10px;margin:10px 0 4px 0}
.level-buttons{display:flex;flex-wrap:wrap;justify-content:center;margin:6px 0 2px 0}
.level-buttons button{width:40px;height:40px;margin:3px;font-size:1em;border-radius:6px;background:#66ccff;border:1px solid #0077cc;font-weight:bold}
.level-buttons button.active{background:#ff9933;color:#fff}
.icon-btn{width:50px;height:50px;margin:5px;border:2px solid #333;border-radius:6px;font-size:1.1em;font-weight:bold;background:#fff;cursor:pointer}
.btn-add{color:red}.btn-sub{color:darkblue}.btn-reset{color:orange}
.problem{display:inline-block;margin:20px 0}
.row{display:flex;justify-content:center;align-items:center}
.cell{width:60px;height:60px;border:2px solid #000;text-align:center;line-height:60px;font-size:2em;margin:2px;border-radius:6px;background:#fff}
.blue{background:#cceeff;font-weight:bold}.yellow{background:#ff6;font-weight:bold}
.carry{background:#fc9;width:60px;height:50px;line-height:50px;font-size:2em;margin:2px;border-radius:6px;text-align:center;font-weight:bold}
.operator{font-size:2.2em;font-weight:bold;color:#0077cc;margin:5px;width:40px;text-align:center}
.result{margin-top:15px;font-weight:bold;font-size:1.2em;padding:12px;border-radius:10px;display:inline-block;min-width:120px}
.correct{background:#0c6;color:#fff}.wrong{background:#c00;color:#fff}
#statsRow{display:flex;justify-content:center;align-items:flex-start;gap:16px}
#chartBox{width:220px;min-height:140px}#progressChart{width:100%!important;height:140px!important}
#leaderboard{width:220px;background:#f9f9f9;border:1px solid #ccc;border-radius:10px;padding:10px;font-size:.95em;text-align:left}
#leaderboard h4{margin:0 0 8px 0;color:#0077cc;text-align:center}
</style></head><body>
<div class="container"><h2>Ứng dụng luyện cộng & trừ lớp 1</h2>
<div id="setupArea"><div class="input-row"><input id="studentName" placeholder="Tên học sinh"><button id="btnAdd" class="icon-btn btn-add">+</button><button id="btnSub" class="icon-btn btn-sub">−</button></div>
<div class="level-buttons" id="levelButtons"></div>
<div id="statsRow"><div id="chartBox"><canvas id="progressChart"></canvas><div style="margin-top:10px;text-align:left;width:220px"><button id="resetAllBtn" class="icon-btn btn-reset">↻</button></div></div><div id="leaderboard"><h4>Top 10 học sinh</h4><ul id="leaderboardList"></ul></div></div></div>
<div id="gameArea" style="display:none;position:relative"><div id="resetBox" style="position:absolute;top:10px;right:10px;text-align:center"><button id="resetBtn" class="icon-btn btn-reset">↻</button><div id="personalStats" style="margin-top:5px;font-weight:bold;color:#0077cc"></div></div>
<div class="problem" id="problem"></div><div id="resultBox" class="result"></div>
<div style="margin-top:10px;"><button id="checkBtn">Kiểm tra</button><button id="nextBtn">Câu tiếp theo</button><button id="backBtn">Quay lại</button></div></div>
<audio id="soundCorrect" src="6964759375754.mp4"></audio><audio id="soundWrong" src="oh-no-392258.mp3"></audio></div>
<script>
let currentOp="",num1=0,num2=0,correctAnswer=0,currentLevel=1,alreadyChecked=false,progressChart=null;
function splitDigits(n){return n<10?["",n]:[Math.floor(n/10),n%10]}function hasCarry(a,b){return a%10+b%10>=10}function hasBorrow(a,b){return a%10<b%10}
function renderLevelButtons(){const c=document.getElementById("levelButtons");c.innerHTML="";for(let i=1;i<=12;i++){const b=document.createElement("button");b.innerText=i;b.onclick=()=>selectLevel(i,b);if(i===1)b.classList.add("active");c.appendChild(b)}}function selectLevel(l,b){currentLevel=l;document.querySelectorAll(".level-buttons button").forEach(x=>x.classList.remove("active"));b.classList.add("active")}
function getRangeByLevel(l){if(l<=3)return 10;if(l<=6)return 20;if(l<=9)return 50;return 99}
function nextProblem(){alreadyChecked=false;let r=getRangeByLevel(currentLevel);do{num1=Math.floor(Math.random()*r);num2=Math.floor(Math.random()*r);if(currentOp==="sub"&&num1<num2)[num1,num2]=[num2,num1];correctAnswer=currentOp==="add"?num1+num2:num1-num2;if(currentOp==="add"&&correctAnswer>99)continue;if(currentOp==="sub"&&correctAnswer<0)continue;if(currentLevel<=6){if(currentOp==="add"&&hasCarry(num1,num2))continue;if(currentOp==="sub"&&hasBorrow(num1,num2))continue}break}while(true);const op=currentOp==="add"?"+":"-";const d1=splitDigits(num1),d2=splitDigits(num2);document.getElementById("problem").innerHTML=`<div class='row'><div class='operator'>&nbsp;</div><input id='carryTop' class='carry' readonly><div style="width:60px;"></div></div><div class='row'><div class='operator'>${op}</div><div class='cell blue'>${d1[0]}</div><div class='cell blue'>${d1[1]}</div></div><div class='row'><div class='operator'>&nbsp;</div><div class='cell blue'>${d2[0]}</div><div class='cell blue'>${d2[1]}</div></div><div class='row'><div class='operator'>=</div><input id='ansTens' class='cell yellow'/><input id='ansOnes' class='cell yellow'/></div>`;enhanceInputs();document.getElementById("resultBox").innerHTML=""}
function setupSingleDigitInput(e){if(!e)return;e.setAttribute("maxlength","1");e.setAttribute("inputmode","numeric");e.addEventListener("input",()=>{e.value=e.value.replace(/\D+/g,"")});e.addEventListener("focus",()=>{e.value=""})}
function enhanceInputs(){["ansTens","ansOnes"].forEach(id=>setupSingleDigitInput(document.getElementById(id)));const ones=document.getElementById("ansOnes");ones.addEventListener("input",()=>{const v=ones.value;if(v.length===1){if(currentOp==="add"){if(num1%10+num2%10>=10&&v==(num1%10+num2%10)%10)document.getElementById("carryTop").value="+1"}else if(currentOp==="sub"){if(num1%10<num2%10&&v==(10+num1%10-num2%10))document.getElementById("carryTop").value="-1"}}})}
function checkAnswer(){const t=parseInt(document.getElementById("ansTens").value)||0,o=parseInt(document.getElementById("ansOnes").value)||0,ans=10*t+o,box=document.getElementById("resultBox"),name=(document.getElementById("studentName").value||"NoName").trim()||"NoName",today=new Date().toISOString().split("T")[0];if(ans===correctAnswer){box.innerHTML="ĐÚNG";box.className="result correct";try{document.getElementById("soundCorrect").play()}catch(e){}if(!alreadyChecked)saveResult(name,today,true)}else{box.innerHTML="SAI";box.className="result wrong";try{document.getElementById("soundWrong").play()}catch(e){}if(!alreadyChecked)saveResult(name,today,false)}alreadyChecked=true}
function saveResult(n,d,c){const k="results",data=JSON.parse(localStorage.getItem(k)||"{}");if(!data[n])data[n]={};if(!data[n][d])data[n][d]={right:0,wrong:0};if(c)data[n][d].right++;else data[n][d].wrong++;localStorage.setItem(k,JSON.stringify(data));loadStats(n)}
function loadStats(n){const all=JSON.parse(localStorage.getItem("results")||"{}"),stats=all[n]||{};if(window.Chart){const labs=Object.keys(stats),R=labs.map(d=>stats[d].right),W=labs.map(d=>stats[d].wrong),ctx=document.getElementById("progressChart").getContext("2d");if(progressChart)progressChart.destroy();progressChart=new Chart(ctx,{type:"bar",data:{labels:labs.length?labs:["Chưa có"],datasets:[{label:"Đúng",data:R.length?R:[0],backgroundColor:"green"},{label:"Sai",data:W.length?W:[0],backgroundColor:"red"}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true}}}})}updateLeaderboard();let r=0,w=0;for(let d in stats){r+=stats[d].right;w+=stats[d].wrong}document.getElementById("personalStats").innerText=`${n}: ${r}/${r+w}`}
function updateLeaderboard(){const data=JSON.parse(localStorage.getItem("results")||"{}");let arr=[];for(let n in data){let R=0,W=0;for(let d in data[n]){R+=data[n][d].right;W+=data[n][d].wrong}let T=R+W;if(T>0)arr.push({name:n,right:R,total:T,ratio:R/T})}arr.sort((a,b)=>b.ratio-a.ratio);arr=arr.slice(0,10);const L=document.getElementById("leaderboardList");L.innerHTML="";arr.forEach(s=>{const li=document.createElement("li");li.textContent=`${s.name}: ${s.right}/${s.total}`;L.appendChild(li)})}
function goBack(){document.getElementById("gameArea").style.display="none";document.getElementById("setupArea").style.display="block"}
function startGame(op){const n=(document.getElementById("studentName").value||"").trim();if(!n){alert("Vui lòng nhập tên học sinh trước khi chơi!");return}currentOp=op;document.getElementById("setupArea").style.display="none";document.getElementById("gameArea").style.display="block";loadStats(n);nextProblem()}
window.addEventListener("load",()=>{renderLevelButtons();document.getElementById("btnAdd").onclick=()=>startGame("add");document.getElementById("btnSub").onclick=()=>startGame("sub");document.getElementById("checkBtn").onclick=checkAnswer;document.getElementById("nextBtn").onclick=nextProblem;document.getElementById("backBtn").onclick=goBack;document.getElementById("resetBtn").onclick=()=>{const n=(document.getElementById("studentName").value||"NoName").trim()||"NoName",d=JSON.parse(localStorage.getItem("results")||"{}");if(d[n]){delete d[n];localStorage.setItem("results",JSON.stringify(d))}loadStats(n)};document.getElementById("resetAllBtn").onclick=()=>{if(confirm("Bạn có chắc muốn xóa toàn bộ thống kê của tất cả học sinh?")){localStorage.removeItem("results");if(progressChart)progressChart.destroy();const ctx=document.getElementById("progressChart").getContext("2d");progressChart=new Chart(ctx,{type:"bar",data:{labels:["Chưa có"],datasets:[{label:"Đúng",data:[0],backgroundColor:"green"},{label:"Sai",data:[0],backgroundColor:"red"}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true}}}});const n=(document.getElementById("studentName").value||"").trim();if(n)loadStats(n);else updateLeaderboard()}}});
</script></body></html>
